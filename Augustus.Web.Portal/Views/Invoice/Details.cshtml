@model IEnumerable<WorkDoneItem>
@{
    var account = (Account)ViewBag.Account;
    var opportunity = (Opportunity)ViewBag.Opportunity;
    var invoice = (Invoice)ViewBag.Invoice;
    ViewBag.Title = invoice.Name;
}

<ol class="breadcrumb">
    <li><a href="@Url.Action("ActiveAccounts", "Organization")">True Clarity</a></li>
    <li>@Html.ActionLink(account.Name, "Invoices", "Account", new { id = account.Id }, null)</li>
    <li>@Html.ActionLink(opportunity.Name, "Invoices", "Opportunity", new { id = opportunity.Id }, null)</li>
</ol>

<div class="row">
    <div class="col-md-4">
        <div class="list-group">
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>Margin</strong></div>
                    <div class="col-xs-6 text-right">@CurrencyHelper.Format(invoice.Margin)</div>
                </div>
            </div>
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>Cost</strong></div>
                    <div class="col-xs-6 text-right">@CurrencyHelper.Format(invoice.Cost)</div>
                </div>
            </div>
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>Revenue</strong></div>
                    <div class="col-xs-6 text-right">@CurrencyHelper.Format(invoice.Revenue)</div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="list-group">
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>Proposal Date</strong></div>
                    <div class="col-xs-6 text-right"></div>
                </div>
            </div>
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>SDN Date</strong></div>
                    <div class="col-xs-6 text-right"></div>
                </div>
            </div>
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>Invoice Date</strong></div>
                    <div class="col-xs-6 text-right">@DateTimeHelper.Format(invoice.InvoiceDate)</div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="list-group">
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>PO No.</strong></div>
                    <div class="col-xs-6 text-right">@invoice.PONumber</div>
                </div>
            </div>
            <div class="list-group-item">
                <div class="row">
                    <div class="col-xs-6"><strong>Invoice No.</strong></div>
                    <div class="col-xs-6 text-right">@invoice.InvoiceNo</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">Work Done</div>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th class="currency">Margin</th>
                </tr>
            </thead>
            @foreach (var i in Model)
            {
                <tr>
                    <td>@DateTimeHelper.Format(i.WorkDoneDate)</td>
                    <td class="currency">@CurrencyHelper.Format(i.Margin)</td>
                </tr>
            }
            <tfoot>
                <tr>
                    <td>Total</td>
                    <td class="currency">@CurrencyHelper.Format(Model.Sum(i => i.Margin))</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div>
    <a class="btn btn-default" target="_blank" href="https://trueclarity4.crm4.dynamics.com/main.aspx?etc=10010&id={@invoice.Id}&pagetype=entityrecord">Open in CRM</a>
</div>
